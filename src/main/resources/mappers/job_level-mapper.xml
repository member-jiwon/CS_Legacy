<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Job">
	<!-- 사원 목록 조회 (직급 + 부서 + 초대 상태 포함) -->
	<select id="getApprovedMembersWithJobDetail" resultType="map">
	    SELECT
	        m.EMAIL,
	        m.NAME,
	        m.COMPANY_CODE,
	        m.signup_at,
	        m.status AS STATUS,
	        m.dept_code,
	        NVL(d.dept_name, '미정') AS dept_name,
	        m.level_code,
	        NVL(j.level_name, '미정') AS level_name
	    FROM member m
	        LEFT JOIN job_level j
	            ON m.level_code = j.level_code
	            AND m.company_code = j.company_code
	        LEFT JOIN department d
	            ON m.dept_code = d.dept_code
	            AND m.company_code = d.company_code
	    WHERE m.status IN ('직원', '퇴사', '승인')
	    ORDER BY m.signup_at DESC
	</select>

	<!-- 회사 코드 출력 -->
	<select id="selectCompanyCode" resultType="string">
		SELECT company_code
		FROM job_level
		WHERE ROWNUM = 1
	</select>

	<!-- 직급 전체 조회 -->
	<select id="getselect"
		resultType="com.kedu.admin.job.level.Job_levelDTO">
		SELECT * FROM job_level ORDER BY level_code DESC
	</select>


	<!-- 사원 부서 업데이트 -->
	<update id="updateMemberDept" parameterType="map">
		UPDATE member
		SET
		dept_code = #{dept_code}
		WHERE email = #{email}
		AND company_code =
		#{company_code}
	</update>

	<!-- 사원 직급 업데이트 -->
	<update id="updateMemberLevel" parameterType="map">
		UPDATE member
		SET
		level_code = #{level_code}
		WHERE email = #{email}
		AND company_code =
		#{company_code}
	</update>

	<!-- 퇴사 혹은 직원 버튼 클릭 시 -->
	<update id="updateMemberStatus" parameterType="map">
		UPDATE member
		SET
		STATUS = #{status}
		WHERE EMAIL= #{email}
		AND COMPANY_CODE = #{company_code}
	</update>

</mapper>